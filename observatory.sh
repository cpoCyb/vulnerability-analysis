#!/bin/bash

# Chemin vers le fichier contenant les URLs
FICHIER_URLS="./liste.txt"
echo "Liste des urls problèmatique" > ./result.txt

echo Quel score minimum ?
read scoreMin

# Lire le fichier /liste.txt ligne par ligne
while IFS= read -r url
do
    # Traitement de l'URL: $url
    observatory $url --format=report > ./report/$url.txt # Traitement par observatory puis stockage dans /report/$url.txt
    grep 'Score: ' ./report/$url.txt > ./score/$url.txt # Recherche de la varible score dans /report/$url.txt puis stockage dans /score/$url.txt
    nombre=$(grep -o '[0-9]\+' ./score/$url.txt | head -n 1) # Recupération du score et stockage dans la variable nombre
    # Vérification si le score et inférieur à $scoreMin
    if [ $nombre -le $scoreMin ]; then
        echo "ATTENTION, le score de $url et de $nombre"
        echo "ATTENTION, le score de $url et de $nombre" >> ./result.txt
    fi
done < "$FICHIER_URLS"

